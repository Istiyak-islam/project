{% extends "base.html" %}
{% block title %}All Submissions{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">All Student Submissions</h2>

    {% if submissions %}
    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Student Name</th>
                <th>Exam Title</th>
                <th>Code / Submission</th>
                <th>Submitted At</th>
                <th>Marks</th>
                <th>Assign / Update Marks</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for sub in submissions %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ sub.student_name }}</td>
                <td>{{ sub.exam_title }}</td>
                <td>
                    {% if sub.code %}
                        <pre style="max-height:150px; overflow:auto;">{{ sub.code }}</pre>
                    {% elif sub.file_name %}
                        {{ sub.file_name }}
                    {% else %}
                        No Submission
                    {% endif %}
                </td>
                <td>{{ sub.submitted_at.strftime("%Y-%m-%d %H:%M:%S") }}</td>
                <td>{{ sub.mark if sub.mark is not none else 'Not graded' }}</td>
                <td>
                    <form method="POST" action="{{ url_for('save_mark') }}" class="d-flex flex-column">
                        <input type="hidden" name="submission_id" value="{{ sub.id }}">
                        <input type="number" step="0.01" name="mark" class="form-control mb-1" placeholder="Enter marks" value="{{ sub.mark or '' }}" required>
                        <button type="submit" class="btn btn-sm btn-success">Save</button>
                    </form>
                </td>
                <td>
                    {% if sub.file_name %}
                        <a href="{{ url_for('download_submission', filename=sub.file_name) }}" class="btn btn-primary btn-sm">Download</a>
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-center">No submissions yet.</p>
    {% endif %}

    <a href="{{ url_for('teacher_dashboard') }}" class="btn btn-danger mt-3">Back to Dashboard</a>
</div>
{% endblock %}
